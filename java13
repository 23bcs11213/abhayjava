package com.example.loginform;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpSession;

@SpringBootApplication
public class LoginFormApplication {

    public static void main(String[] args) {
        SpringApplication.run(LoginFormApplication.class, args);
    }

    // --- Controller for Login ---
    @Controller
    public static class LoginController {

        // Display login form
        @GetMapping("/login")
        public String loginForm(Model model, HttpSession session) {
            model.addAttribute("error", session.getAttribute("error"));
            session.removeAttribute("error");
            return "login";
        }

        // Handle login submission
        @PostMapping("/login")
        public String loginSubmit(@RequestParam String username,
                                  @RequestParam String password,
                                  HttpSession session) {
            // Simple hardcoded authentication
            if ("admin".equals(username) && "1234".equals(password)) {
                session.setAttribute("user", username);
                return "redirect:/welcome";
            } else {
                session.setAttribute("error", "Invalid username or password");
                return "redirect:/login";
            }
        }

        // Welcome page after login
        @GetMapping("/welcome")
        public String welcomePage(HttpSession session, Model model) {
            Object user = session.getAttribute("user");
            if (user == null) return "redirect:/login";
            model.addAttribute("username", user.toString());
            return "welcome";
        }

        // Logout
        @GetMapping("/logout")
        public String logout(HttpSession session) {
            session.invalidate();
            return "redirect:/login";
        }
    }
}
